<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VinWonders</title>
      <link rel="icon" type="image/png" href="/assets/iconlogo.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
    <style>
     @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');

      *{
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: "Open Sans", sans-serif;
      }

      body {
        width: 100%;
        height: 100vh;
        background: #fff;
        padding: 16px;
        display: flex;
        justify-content: center; /* cƒÉn gi·ªØa ngang */
        align-items: flex-start; /* cƒÉn gi·ªØa d·ªçc */
      }

      .wrapperCart {
        display: flex;
        flex-direction: column;
        width: 800px;
      }

      .wrapperIcon {
        padding: 6px;
        color: #f77119;
        font-size: 20px;
        cursor: pointer;
      }
      h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #f77119;
      }

      .cart-item {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
      }

      .cart-item-content {
        display: flex;
        align-items: flex-start;
        padding: 16px;
      }

      .cart-item img {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        object-fit: cover;
        margin-right: 12px;
      }

      .cart-info h4 {
        font-size: 15px;
        color: #222;
      }

      .cart-info p {
        color: #666;
        font-size: 13px;
      }

      .cart-tags {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 6px;
      }

      .tag {
        background: #ffe8da;
        color: #f77119;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .cart-footer {
        display: flex;
        justify-content: space-between;
        padding: 12px 16px;
        border-top: 1px solid #f0f0f0;
        font-size: 13px;
      }

      .cart-footer a {
        color: #007aff;
        text-decoration: none;
      }

      .cart-footer a:hover {
        text-decoration: underline;
      }

      .discount-section {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: #fff;
        border-radius: 10px;
        margin-top: 20px;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
      }

      .discount-section input {
        border: none;
        outline: none;
        font-size: 14px;
        width: 60%;
      }

      .total-section {
        background: #fff;
        padding: 16px;
        border-radius: 10px;
        margin-top: 10px;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
      }

      .total-section p {
        font-size: 14px;
        color: #777;
      }

      .total-section h3 {
        color: #f77119;
        margin-top: 4px;
      }

      .continue-btn {
        width: 100%;
        background: #f77119;
;
        color: #fff;
        border: none;
        border-radius: 10px;
        padding: 14px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
      }

      .continue-btn:hover {
        opacity: 0.9;
      }
      .modalBuyTicket {
        display: none;
        justify-content: center;
        align-items: center;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
      }

      .modal-content {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        width: 90%;
        max-width: 420px;
      }

      .edit-btn {
        background: none;
        border: none;
        color: #007aff;
        cursor: pointer;
      }

      .edit-btn:hover {
        text-decoration: underline;
      }
      /* --- Modal overlay --- */
      .modalBuyTicket {
        display: none;
        justify-content: center;
        align-items: center;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(2px);
      }

      /* --- Modal box --- */
      .modal-content {
        background: #fff;
        border-radius: 16px;
        padding: 24px;
        width: 90%;
        max-width: 420px;
        position: relative;
        animation: fadeIn 0.3s ease;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      }

      .delete-btn {
        display: flex;
        align-items: center;
        gap: 6px; /* kho·∫£ng c√°ch gi·ªØa icon v√† ch·ªØ */
        background-color: #ffe5e5; /* n·ªÅn ƒë·ªè nh·∫°t */
        color: #d62828; /* ƒë·ªè ch√≠nh */
        border: none;
        border-radius: 8px;
        padding: 8px 14px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .delete-btn i {
        font-size: 16px;
      }

      .delete-btn:hover {
        background-color: #d62828; /* ƒë·∫≠m h∆°n khi hover */
        color: #fff; /* ch·ªØ v√† icon tr·∫Øng */
      }

      .delete-btn:active {
        transform: scale(0.97);
        opacity: 0.9;
      }

      @keyframes fadeIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* --- Close button --- */
      .close-btn {
        position: absolute;
        right: 16px;
        top: 12px;
        font-size: 20px;
        color: #555;
        cursor: pointer;
      }

      .close-btn:hover {
        color: #ff6600;
      }

      /* --- Title --- */
      .modal-title {
        font-size: 18px;
        font-weight: 600;
        color: #222;
        text-align: center;
        margin-bottom: 20px;
      }

      /* --- Section styles --- */
      .location-section,
      .time-section,
      .quantity-section {
        margin-bottom: 18px;
      }

      .location-section h4,
      .time-section h4,
      .quantity-section h4 {
        font-size: 15px;
        color: #444;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      /* --- Option buttons --- */
      .location-options button,
      .time-options button {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px 14px;
        font-size: 14px;
        cursor: pointer;
        background: #f8f8f8;
        margin-right: 6px;
        transition: 0.2s;
      }

      .location-options button:hover,
      .time-options button:hover {
        background: #f0f0f0;
      }

      .location-options button.active,
      .time-options button.active {
        background: #f77119;
        color: #fff;
        border: none;
      }

      /* --- Quantity counter --- */
      .ticket-type {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        background: #fafafa;
        border-radius: 8px;
        border: 1px solid #eee;
      }

      .counter {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .counter button {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        border: none;
        background: #f77119;
        color: #fff;
        font-size: 18px;
        line-height: 1;
        cursor: pointer;
        transition: 0.2s;
      }

      .counter button:hover {
        opacity: 0.85;
      }

      .count {
        font-weight: 500;
        font-size: 15px;
      }

      /* --- Footer --- */
      .footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 18px;
        border-top: 1px solid #eee;
        padding-top: 12px;
      }

      .footer .total {
        font-size: 16px;
        font-weight: 600;
        color: #f77119;
      }

      .save-btn {
        background: #f77119;
        border: none;
        border-radius: 8px;
        color: #fff;
        padding: 10px 16px;
        font-size: 14px;
        cursor: pointer;
        transition: 0.2s;
      }

      .save-btn:hover {
        opacity: 0.9;
      }
      .input-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 14px;
      }

      .input-group label {
        font-size: 14px;
        margin-bottom: 6px;
        color: #444;
      }

      .input-group input {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 10px;
        font-size: 14px;
      }
    </style>
  </head>

  <body>
    <div class="wrapperCart">
      <a href="./ticket-detail.html">
        <i class="fa-solid fa-arrow-left wrapperIcon"></i>
      </a>
      <h2>Gi·ªè h√†ng</h2>
      <div id="cartContainer"></div>

      <div class="discount-section">
        <div><i class="fa-solid fa-percent"></i> M√£ ∆∞u ƒë√£i</div>
        <input type="text" placeholder="Ch·ªçn nh·∫≠p m√£ ∆∞u ƒë√£i" />
      </div>

      <div class="total-section">
        <p>T·ªïng c·ªông: (ƒê√£ bao g·ªìm VAT)</p>
        <h3 id="totalPrice">0 ƒë</h3>
        <button class="continue-btn">Ti·∫øp t·ª•c</button>

        <!-- Modal s·ª≠a v√© -->
        <div id="editModal" class="modalBuyTicket">
          <div class="modal-content ticket-buy">
            <span class="close-btn">&times;</span>
            <h3 class="modal-title">S·ª≠a th√¥ng tin v√©</h3>

            <div class="location-section">
              <h4><i class="fa-solid fa-location-dot"></i> C∆° s·ªü</h4>
              <div class="location-options">
                <button class="active">ZooKeeper NT</button>
                <button>Harbour</button>
              </div>
            </div>

            <div class="time-section">
              <h4><i class="fa-regular fa-clock"></i> Th·ªùi gian</h4>
              <div class="time-options">
                <button class="time-btn active">9:30</button>
                <button class="time-btn">14:00</button>
              </div>
            </div>

            <div class="quantity-section">
              <h4><i class="fa-solid fa-user-group"></i> S·ªë l∆∞·ª£ng</h4>
              <div class="ticket-type">
                <p>Ng∆∞·ªùi l·ªõn</p>
                <div class="counter">
                  <button class="minus">‚àí</button>
                  <span class="count">1</span>
                  <button class="plus">+</button>
                </div>
              </div>
            </div>

            <div class="footer">
              <span class="total">100,000 ƒë</span>
              <button class="save-btn">L∆∞u thay ƒë·ªïi</button>
            </div>
          </div>
        </div>

        <!-- Modal nh·∫≠p th√¥ng tin ng∆∞·ªùi d√πng -->
        <div id="userModal" class="modalBuyTicket">
          <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3 class="modal-title">Th√¥ng tin thanh to√°n</h3>

            <div class="input-group">
              <label>H·ªç v√† t√™n</label>
              <input
                type="text"
                id="fullName"
                placeholder="Nh·∫≠p h·ªç t√™n c·ªßa b·∫°n"
                required />
            </div>

            <div class="input-group">
              <label>S·ªë ƒëi·ªán tho·∫°i</label>
              <input
                type="tel"
                id="phoneNumber"
                placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
                required />
            </div>

            <button
              id="confirmPaymentBtn"
              class="save-btn"
              style="width: 100%; margin-top: 10px">
              X√°c nh·∫≠n thanh to√°n
            </button>
          </div>
        </div>

        <!-- Modal bill -->
        <div id="billModal" class="modalBuyTicket">
          <div class="modal-content" style="max-width: 500px">
            <span class="close-btn">&times;</span>
            <h3 class="modal-title">Ho√° ƒë∆°n thanh to√°n</h3>
            <div id="billContent"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const cartContainer = document.getElementById("cartContainer");
      const totalPriceEl = document.getElementById("totalPrice");

      // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
      const cartData = JSON.parse(localStorage.getItem("cart")) || [];

      function renderCart() {
        cartContainer.innerHTML = "";
        let total = 0;

        if (cartData.length === 0) {
          cartContainer.innerHTML =
            "<p style='text-align:center;color:#888;'>Ch∆∞a c√≥ v√© n√†o trong gi·ªè h√†ng</p>";
          totalPriceEl.textContent = "0 ƒë";

          // ·∫®n ph·∫ßn m√£ gi·∫£m gi√° v√† t·ªïng ti·ªÅn
          document.querySelector(".discount-section").style.display = "none";
          document.querySelector(".total-section").style.display = "none";

          return;
        } else {
          // Hi·ªán l·∫°i n·∫øu c√≥ s·∫£n ph·∫©m
          document.querySelector(".discount-section").style.display = "flex";
          document.querySelector(".total-section").style.display = "block";
        }

        cartData.forEach((item, index) => {
          total += item.price;

          const card = document.createElement("div");
          card.className = "cart-item";
          card.innerHTML = `
          <div class="cart-item-content">
            <img src="${item.image}" alt="${item.title}" />
            <div class="cart-info">
              <p style="font-weight:500;color:#555;">${item.location}</p>
              <h4>${item.title}</h4>
              <div class="cart-tags">
                <div class="tag"><i class="fa-solid fa-map-pin"></i> ${item.branch}</div>
                <div class="tag"><i class="fa-regular fa-clock"></i> ${item.time}</div>
              </div>
              <p style="margin-top:8px;"><i class="fa-regular fa-calendar"></i> ${item.date}</p>
              <p><i class="fa-solid fa-user"></i> ${item.person}</p>
            </div>
          </div>
          <div class="cart-footer">
            <button class="delete-btn" data-index="${index}">
              <i class="fa-regular fa-trash-can"></i> X√≥a v√©
            </button>
            <button class="edit-btn" data-index="${index}">
    <i class="fa-regular fa-pen-to-square"></i> S·ª≠a v√©
 
        `;
          cartContainer.appendChild(card);
        });

        totalPriceEl.textContent = total.toLocaleString("vi-VN") + " ƒë";

        // Attach edit event listeners after rendering
        document.querySelectorAll(".edit-btn").forEach((btn, index) => {
          btn.addEventListener("click", () => {
            currentEditIndex = btn.dataset.index;
            const item = cart[currentEditIndex];

            // C·∫≠p nh·∫≠t c∆° s·ªü
            editModal
              .querySelectorAll(".location-options button")
              .forEach((b) => {
                b.classList.toggle(
                  "active",
                  b.textContent.trim() === item.branch
                );
              });

            // ‚úÖ FIX l·ªói tr√πng gi·ªù: reset v√† g√°n l·∫°i n√∫t gi·ªù ƒë√∫ng
            const timeOptions = editModal.querySelector(".time-options");
            const availableTimes = ["9:30", "14:00"];
            timeOptions.innerHTML = ""; // xo√° h·∫øt c√°c n√∫t c≈©

            availableTimes.forEach((time) => {
              const btnTime = document.createElement("button");
              btnTime.classList.add("time-btn");
              btnTime.textContent = time;
              if (time === item.time) btnTime.classList.add("active");
              timeOptions.appendChild(btnTime);
            });

            // G√°n l·∫°i s·ª± ki·ªán click cho c√°c n√∫t gi·ªù m·ªõi
            timeOptions.querySelectorAll("button").forEach((b) => {
              b.addEventListener("click", () => {
                timeOptions
                  .querySelectorAll("button")
                  .forEach((t) => t.classList.remove("active"));
                b.classList.add("active");
              });
            });

            // S·ªë l∆∞·ª£ng ng∆∞·ªùi
            editModal.querySelector(".count").textContent =
              item.person.match(/\d+/)[0];

            updateEditTotal();
            editModal.style.display = "flex";
          });
        });
      }

      renderCart();

      // X√≥a v√©
      document.addEventListener("click", (e) => {
        if (e.target.closest(".delete-btn")) {
          const index = e.target.closest(".delete-btn").dataset.index;
          cartData.splice(index, 1);
          localStorage.setItem("cart", JSON.stringify(cartData));
          renderCart();
        }
      });

      const editModal = document.getElementById("editModal");
      const editCloseBtn = editModal.querySelector(".close-btn");
      const saveBtn = editModal.querySelector(".save-btn");
      const totalElement = editModal.querySelector(".total");

      let currentEditIndex = null;
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      // --- M·ªü modal khi b·∫•m n√∫t S·ª≠a ---
      document.querySelectorAll(".edit-btn").forEach((btn, index) => {
        btn.addEventListener("click", () => {
          currentEditIndex = index;
          const item = cart[index];

          // C·∫≠p nh·∫≠t c∆° s·ªü
          editModal
            .querySelectorAll(".location-options button")
            .forEach((b) => {
              b.classList.toggle(
                "active",
                b.textContent.trim() === item.branch
              );
            });

          // ‚úÖ FIX l·ªói tr√πng gi·ªù: reset v√† g√°n l·∫°i n√∫t gi·ªù ƒë√∫ng
          const timeOptions = editModal.querySelector(".time-options");
          const availableTimes = ["9:30", "14:00"];
          timeOptions.innerHTML = ""; // xo√° h·∫øt c√°c n√∫t c≈©

          availableTimes.forEach((time) => {
            const btnTime = document.createElement("button");
            btnTime.classList.add("time-btn");
            btnTime.textContent = time;
            if (time === item.time) btnTime.classList.add("active");
            timeOptions.appendChild(btnTime);
          });

          // G√°n l·∫°i s·ª± ki·ªán click cho c√°c n√∫t gi·ªù m·ªõi
          timeOptions.querySelectorAll("button").forEach((b) => {
            b.addEventListener("click", () => {
              timeOptions
                .querySelectorAll("button")
                .forEach((t) => t.classList.remove("active"));
              b.classList.add("active");
            });
          });

          // S·ªë l∆∞·ª£ng ng∆∞·ªùi
          editModal.querySelector(".count").textContent =
            item.person.match(/\d+/)[0];

          updateEditTotal();
          editModal.style.display = "flex";
        });
      });

      // --- ƒê√≥ng modal ---
      editCloseBtn.addEventListener(
        "click",
        () => (editModal.style.display = "none")
      );

      // --- C·∫≠p nh·∫≠t t·ªïng ti·ªÅn ---
      function updateEditTotal() {
        const count = parseInt(editModal.querySelector(".count").textContent);
        const price = 100000;
        totalElement.textContent =
          (count * price).toLocaleString("vi-VN") + " ƒë";
      }

      // --- Thay ƒë·ªïi s·ªë l∆∞·ª£ng ---
      editModal.querySelector(".plus").addEventListener("click", () => {
        const countEl = editModal.querySelector(".count");
        countEl.textContent = parseInt(countEl.textContent) + 1;
        updateEditTotal();
      });

      editModal.querySelector(".minus").addEventListener("click", () => {
        const countEl = editModal.querySelector(".count");
        if (parseInt(countEl.textContent) > 0)
          countEl.textContent = parseInt(countEl.textContent) - 1;
        updateEditTotal();
      });

      // --- Ch·ªçn c∆° s·ªü ---
      editModal.querySelectorAll(".location-options button").forEach((btn) => {
        btn.addEventListener("click", () => {
          editModal
            .querySelectorAll(".location-options button")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
        });
      });

      // --- Ch·ªçn th·ªùi gian ---
      editModal.querySelectorAll(".time-options button").forEach((btn) => {
        btn.addEventListener("click", () => {
          editModal
            .querySelectorAll(".time-options button")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
        });
      });

      // --- L∆∞u thay ƒë·ªïi ---
      saveBtn.addEventListener("click", () => {
        if (currentEditIndex !== null) {
          const branch = editModal.querySelector(
            ".location-options .active"
          ).textContent;
          const time = editModal.querySelector(".time-btn.active").textContent;
          const personCount = editModal.querySelector(".count").textContent;
          const total = parseInt(totalElement.textContent.replace(/\D/g, ""));

          cart[currentEditIndex] = {
            ...cart[currentEditIndex],
            branch,
            time,
            person: `${personCount} ng∆∞·ªùi`,
            price: total,
          };

          localStorage.setItem("cart", JSON.stringify(cart));
          editModal.style.display = "none";
          window.location.reload(); // reload l·∫°i giao di·ªán ƒë·ªÉ th·∫•y thay ƒë·ªïi
        }
      });

      // --- Modal nh·∫≠p th√¥ng tin ---
      const continueBtn = document.querySelector(".continue-btn");
      const userModal = document.getElementById("userModal");
      const billModal = document.getElementById("billModal");
      const confirmPaymentBtn = document.getElementById("confirmPaymentBtn");
      const fullNameInput = document.getElementById("fullName");
      const phoneInput = document.getElementById("phoneNumber");

      // m·ªü modal nh·∫≠p th√¥ng tin
      continueBtn.addEventListener("click", () => {
        userModal.style.display = "flex";
      });

      // ƒë√≥ng modal
      userModal.querySelector(".close-btn").addEventListener("click", () => {
        userModal.style.display = "none";
      });
      billModal.querySelector(".close-btn").addEventListener("click", () => {
        billModal.style.display = "none";

        // Hi·ªÉn th·ªã th√¥ng b√°o thanh to√°n th√†nh c√¥ng
        alert("üéâ Thanh to√°n th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ mua v√© v√†o c·ªïng.");

        // Chuy·ªÉn h∆∞·ªõng sang trang tr√≤ ch∆°i
        window.location.href = "index.html"; // ƒë·ªïi t√™n file n·∫øu trang b·∫°n kh√°c
      });

      // x√°c nh·∫≠n thanh to√°n
      confirmPaymentBtn.addEventListener("click", () => {
        const name = fullNameInput.value.trim();
        const phone = phoneInput.value.trim();

        if (!name || !phone) {
          alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß h·ªç t√™n v√† s·ªë ƒëi·ªán tho·∫°i!");
          return;
        }

        userModal.style.display = "none";

        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        let total = 0;

        const itemsHTML = cart
          .map((item) => {
            total += item.price;
            return `
        <div style="display:flex;align-items:center;margin-bottom:10px;border-bottom:1px solid #eee;padding-bottom:8px;">
          <img src="${item.image}" alt="${
              item.title
            }" style="width:60px;height:60px;border-radius:8px;margin-right:10px;">
          <div>
            <h4 style="font-size:14px;margin-bottom:4px;">${item.title}</h4>
            <p style="font-size:13px;color:#666;">${item.branch} - ${
              item.time
            }</p>
            <p style="font-size:13px;color:#666;">${item.date} | ${
              item.person
            }</p>
            <p style="font-size:13px;color:#f77119;">${item.price.toLocaleString(
              "vi-VN"
            )} ƒë</p>
          </div>
        </div>
      `;
          })
          .join("");

        const billHTML = `
    <p><strong>H·ªç t√™n:</strong> ${name}</p>
    <p><strong>SƒêT:</strong> ${phone}</p>
    <hr style="margin:10px 0;">
    ${itemsHTML}
    <h3 style="text-align:right;color:#f77119;margin-top:10px;">T·ªïng: ${total.toLocaleString(
      "vi-VN"
    )} ƒë</h3>
    <div style="text-align:center;margin-top:20px;">
      <p>Qu√©t m√£ QR ƒë·ªÉ thanh to√°n</p>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=ThanhToan_${encodeURIComponent(
        name
      )}_${encodeURIComponent(
          phone
        )}_${Date.now()}" alt="QR" style="margin-top:8px;">
    </div>
  `;

        document.getElementById("billContent").innerHTML = billHTML;
        billModal.style.display = "flex";
      });
    </script>
  </body>
</html>
