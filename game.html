<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VinWonders - Trò chơi</title>
    <link rel="icon" type="image/png" href="/assets/iconlogo.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Open Sans", sans-serif;
      }

      body {
        font-family: "Open Sans", sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
        color: #333;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }

      header {
        background: linear-gradient(135deg, #f77119 0%, #e55b00 100%);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 24px;
        box-shadow: 0 4px 12px rgba(247, 113, 25, 0.3);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      header h2 {
        margin: 0;
        font-size: 20px;
        color: #ffffff;
        font-weight: 600;
      }

      header button {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #ffffff;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      header button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
      }

      .container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .card-grid {
        display: grid;
        margin-top: 30px;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 24px;
        width: 100%;
      }

      .game-card {
        background: #fff;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        position: relative;
      }

      .game-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 32px rgba(247, 113, 25, 0.15);
      }

      .game-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }

      .game-content {
        padding: 20px;
      }

      .status-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        color: #fff;
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .status-free {
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
      }

      .status-normal {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      }

      .status-busy {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
      }

      .status-very-busy {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      }
      .status-maintain {
        background: linear-gradient(135deg, #999 0%, #ccc 100%);
        color: #fff !important;
      }

      .game-content h3 {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: 700;
        color: #2c3e50;
        line-height: 1.4;
      }

      .queue-info {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 12px 0;
        padding: 10px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        border-left: 4px solid;
      }

      .queue-info.free {
        border-color: #2ecc71;
      }

      .queue-info.normal {
        border-color: #3498db;
      }

      .queue-info.busy {
        border-color: #f39c12;
      }

      .queue-info.very-busy {
        border-color: #e74c3c;
      }

      .queue-info i {
        font-size: 18px;
      }

      .queue-info.free i {
        color: #2ecc71;
      }
      .queue-info.normal i {
        color: #3498db;
      }
      .queue-info.busy i {
        color: #f39c12;
      }
      .queue-info.very-busy i {
        color: #e74c3c;
      }

      .queue-info .queue-number {
        font-weight: 700;
        font-size: 20px;
      }

      .queue-info .queue-text {
        font-size: 13px;
        color: #666;
      }

      .price-info {
        display: flex;
        align-items: center;
        gap: 6px;
        margin: 10px 0;
        font-size: 14px;
        color: #555;
      }

      .price-info i {
        color: #f77119;
      }

      .price-info strong {
        color: #f77119;
        font-size: 16px;
      }

      .time-info {
        display: flex;
        align-items: center;
        gap: 6px;
        margin: 10px 0;
        font-size: 13px;
        color: #666;
      }

      .time-info i {
        color: #f77119;
      }

      .button-group {
        display: flex;
        gap: 8px;
        margin-top: 16px;
      }

      .btn {
        flex: 1;
        border: none;
        padding: 12px 16px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .btn-priority {
        background: linear-gradient(135deg, #f77119 0%, #e55b00 100%);
        color: #fff;
        box-shadow: 0 4px 12px rgba(247, 113, 25, 0.3);
      }

      .btn-priority:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(247, 113, 25, 0.4);
      }

      .btn-priority:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        opacity: 0.6;
        box-shadow: none;
      }

      .btn-virtual {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: #fff;
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
      }

      .btn-virtual:disabled {
        background: #bdc3c7 !important;
        color: #fff !important;
        cursor: not-allowed;
        opacity: 0.6;
        box-shadow: none;
      }
      .btn-virtual:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(52, 152, 219, 0.4);
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        justify-content: center;
        align-items: center;
        z-index: 999;
        padding: 20px;
      }

      .modal-content {
        background: #fff;
        border-radius: 24px;
        padding: 28px;
        width: 100%;
        max-width: 450px;
        position: relative;
        animation: modalSlideIn 0.3s ease;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .close-btn {
        position: absolute;
        top: 16px;
        right: 20px;
        cursor: pointer;
        font-size: 24px;
        color: #95a5a6;
        transition: all 0.3s ease;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .close-btn:hover {
        color: #e74c3c;
        background: #f8f9fa;
        transform: rotate(90deg);
      }

      .modal h3 {
        margin: 0 0 20px 0;
        font-size: 24px;
        text-align: center;
        color: #2c3e50;
        font-weight: 700;
      }

      .modal-game-info {
        text-align: center;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 2px solid #ecf0f1;
      }

      .modal-game-info img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 12px;
      }

      .modal-game-info h4 {
        margin: 0;
        color: #2c3e50;
        font-size: 18px;
      }

      .input-group {
        margin: 20px 0;
      }

      .input-group label {
        font-weight: 600;
        display: block;
        margin-bottom: 10px;
        color: #2c3e50;
        font-size: 14px;
      }

      .time-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .time-options button {
        flex: 1;
        min-width: 80px;
        padding: 10px 16px;
        border-radius: 12px;
        border: 2px solid #e0e0e0;
        background: #fff;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .time-options button:hover {
        border-color: #f77119;
        transform: scale(1.05);
      }

      .time-options button.active {
        background: linear-gradient(135deg, #f77119 0%, #e55b00 100%);
        color: #fff;
        border-color: #f77119;
        box-shadow: 0 4px 12px rgba(247, 113, 25, 0.3);
      }

      .counter {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 12px;
      }

      .counter button {
        border: none;
        background: linear-gradient(135deg, #f77119 0%, #e55b00 100%);
        color: #fff;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        font-weight: 700;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(247, 113, 25, 0.3);
      }

      .counter button:hover:not(:disabled) {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(247, 113, 25, 0.4);
      }

      .counter button:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        opacity: 0.5;
      }

      .counter span {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        min-width: 40px;
        text-align: center;
      }

      .total-price {
        text-align: center;
        margin: 20px 0;
        padding: 16px;
        background: linear-gradient(135deg, #fff5eb 0%, #ffe8d1 100%);
        border-radius: 12px;
        border: 2px solid #f77119;
      }

      .total-price strong {
        display: block;
        font-size: 14px;
        color: #666;
        margin-bottom: 4px;
      }

      .total-price .price {
        font-size: 28px;
        font-weight: 700;
        color: #f77119;
      }

      .save-btn {
        background: linear-gradient(135deg, #f77119 0%, #e55b00 100%);
        border: none;
        color: #fff;
        width: 100%;
        padding: 14px;
        border-radius: 12px;
        cursor: pointer;
        margin-top: 20px;
        font-weight: 700;
        font-size: 16px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(247, 113, 25, 0.3);
      }

      .save-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(247, 113, 25, 0.4);
      }

      /* Player inputs for virtual queue */
      .player-input {
        margin-bottom: 12px;
      }

      .player-input label {
        font-size: 13px;
        font-weight: 600;
        color: #555;
        margin-bottom: 6px;
        display: block;
      }

      .player-input input {
        width: 100%;
        padding: 10px 12px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .player-input input:focus {
        outline: none;
        border-color: #f77119;
        box-shadow: 0 0 0 3px rgba(247, 113, 25, 0.1);
      }

      /* Bill Modal */
      .bill-content {
        padding: 8px 0;
      }

      .bill-content p {
        margin: 10px 0;
        padding: 8px 0;
        border-bottom: 1px solid #ecf0f1;
        font-size: 14px;
      }

      .bill-content p:last-child {
        border-bottom: none;
      }

      .bill-content strong {
        color: #2c3e50;
        font-weight: 600;
      }

      .qr-section {
        text-align: center;
        margin-top: 20px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 12px;
      }

      .qr-section img {
        margin: 12px 0;
        border-radius: 8px;
      }

      .order-number {
        font-size: 18px;
        font-weight: 700;
        color: #f77119;
        margin-top: 12px;
      }

      /* Toast notification */
      .toast {
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%) translateY(-100px);
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        opacity: 0;
        transition: all 0.4s ease;
        z-index: 2000;
        box-shadow: 0 8px 24px rgba(231, 76, 60, 0.4);
        display: flex;
        align-items: center;
        gap: 10px;
        max-width: 90%;
      }

      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      .toast i {
        font-size: 20px;
      }

      @media (max-width: 768px) {
        .card-grid {
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 16px;
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .modal-content {
          padding: 20px;
          max-width: 95%;
        }
      }

      @media (max-width: 480px) {
        .card-grid {
          grid-template-columns: 1fr;
        }

        .time-options {
          flex-direction: column;
        }

        .time-options button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <button onclick="window.history.back()">
        <i class="fa-solid fa-arrow-left"></i>
      </button>
      <h2>Trò chơi VinWonders</h2>
      <div style="width: 40px"></div>
    </header>

    <!-- Toast notification -->
    <div id="toast" class="toast">
      <i class="fa-solid fa-circle-exclamation"></i>
      <span id="toastMessage"></span>
    </div>

    <div class="container">
      <div class="card-grid" id="gameList"></div>
    </div>

    <!-- Modal Priority Booking -->
    <div class="modal" id="priorityModal">
      <div class="modal-content">
        <span class="close-btn" id="closePriority">&times;</span>
        <h3>Đặt vé ưu tiên</h3>

        <div class="modal-game-info" id="priorityGameInfo"></div>

        <div class="input-group">
          <label>Chọn khung giờ</label>
          <div class="time-options" id="priorityTimeOptions">
            <button class="time-btn active" data-time="9:30">9:30</button>
            <button class="time-btn" data-time="11:00">11:00</button>
            <button class="time-btn" data-time="14:00">14:00</button>
          </div>
        </div>

        <div class="input-group">
          <label>Số lượng người chơi</label>
          <div class="counter">
            <button id="priorityMinus">−</button>
            <span id="priorityCount">1</span>
            <button id="priorityPlus">+</button>
          </div>
        </div>

        <div class="total-price">
          <strong>Tổng tiền</strong>
          <span class="price" id="priorityTotal">100,000 đ</span>
        </div>

        <button class="save-btn" id="confirmPriority">
          <i class="fa-solid fa-check"></i> Xác nhận đặt vé
        </button>
      </div>
    </div>

    <!-- Modal Virtual Queue -->
    <div class="modal" id="virtualModal">
      <div class="modal-content">
        <span class="close-btn" id="closeVirtual">&times;</span>
        <h3>Tham gia hàng ảo</h3>

        <div class="modal-game-info" id="virtualGameInfo"></div>

        <div class="input-group">
          <label>Chọn khung giờ</label>
          <div class="time-options" id="virtualTimeOptions">
            <button class="time-btn active" data-time="9:30">9:30</button>
            <button class="time-btn" data-time="11:00">11:00</button>
            <button class="time-btn" data-time="14:00">14:00</button>
          </div>
        </div>

        <div class="input-group">
          <label>Số lượng người chơi (tối đa 7)</label>
          <div class="counter">
            <button id="virtualMinus">−</button>
            <span id="virtualCount">1</span>
            <button id="virtualPlus">+</button>
          </div>
        </div>

        <div id="playerNames"></div>

        <button class="save-btn" id="confirmVirtual">
          <i class="fa-solid fa-check"></i> Xác nhận tham gia
        </button>
      </div>
    </div>

    <!-- Modal Bill -->
    <div class="modal" id="billModal">
      <div class="modal-content">
        <span class="close-btn" id="closeBill">&times;</span>
        <h3 id="billTitle">Hóa đơn</h3>
        <div class="bill-content" id="billContent"></div>
      </div>
    </div>

    <script>
      const PRICE_PER_PLAYER = 100000;
      const MAX_VIRTUAL_PLAYERS = 7;
      const MAX_CART_ITEMS = 3;

      const games = [
        {
          id: 1,
          title: "Ngôi đền huyền thoại",
          image: "game-image/Ngôi đền huyền thoại.JPG",
          queue: 12,
          wait: "9:00-18:30",
          desc: "Đường ray xuyên núi, hầm mỏ bí ẩn.",
        },
        {
          id: 2,
          title: "Pháo đài kì bí",
          image: "game-image/Pháo đài kì bí.PNG",
          queue: 18,
          wait: "10:00-19:00",
          desc: "Rơi tự do zipfall 20m, cảm giác mạnh.",
        },
        {
          id: 3,
          title: "Vòi rồng hung hãn",
          image: "game-image/Vòi rồng hung hãn.JPG",
          queue: 15,
          wait: "9:30-18:00",
          desc: "Trượt quanh vòng xoáy, hộp đen phấn khích.",
        },
        {
          id: 4,
          title: "Cú rơi thót tim",
          image: "game-image/Cú rơi thót tim.JPG",
          queue: 23,
          wait: "10:00-18:30",
          desc: "Rơi tự do gay cấn trên đường trượt nước.",
        },
        {
          id: 5,
          title: "Đĩa bay vũ trụ",
          image: "game-image/Đĩa bay vũ trụ.JPG",
          queue: 10,
          wait: "9:00-18:00",
          desc: "Đường trượt đoạt giải IAAPA 2015.",
        },
        {
          id: 6,
          title: "Thác đôi thần bí",
          image: "game-image/Thác đôi thần bí.PNG",
          queue: 8,
          wait: "9:00-17:30",
          desc: "Bay khỏi đường trượt cao 21m, tốc độ 60km/h.",
        },
        {
          id: 7,
          title: "Cuộc đua báo Cheetah",
          image: "game-image/Cuộc đua báo Cheetah.jpg",
          queue: 17,
          wait: "9:30-18:30",
          desc: "Đua nước sắc màu, trải nghiệm gia đình.",
        },
        {
          id: 8,
          title: "Tẩu thoát ngoạn mục",
          image: "game-image/Tẩu thoát ngoạn mục.jpg",
          queue: 20,
          wait: "10:00-18:00",
          desc: "4 máng trượt cao 12m, vòng cua uốn lượn.",
        },
        {
          id: 9,
          title: "Ngôi làng thủy tộc",
          image: "game-image/Ngôi làng thuỷ tộc.jpg",
          queue: 22,
          wait: "9:00-18:00",
          desc: "Bể bơi trẻ em, nhiều trò chơi nước.",
        },
        {
          id: 10,
          title: "Cuộc chiến cầu vồng",
          image: "game-image/Cuộc chiến cầu vồng.jpg",
          queue: 30,
          wait: "9:00-18:00",
          desc: "Xe điện đụng, vui nhộn cho gia đình.",
        },
        {
          id: 11,
          title: "Vương quốc kẹo ngọt",
          image: "game-image/Vương quốc kẹo ngọt.jpg",
          queue: 12,
          wait: "9:00-18:00",
          desc: "Tổ hợp trò chơi trong nhà chủ đề bánh kẹo.",
        },
        {
          id: 12,
          title: "Cung điện ánh sáng",
          image: "game-image/Cung điện án sáng.jpg",
          queue: 13,
          wait: "10:00-18:00",
          desc: "Không gian ánh sáng, mở cửa cuối tuần.",
        },
        {
          id: 13,
          title: "Đường lượn nhớ đời",
          image: "game-image/Đường lượn nhớ đời.jpg",
          queue: 32,
          wait: "9:00-18:30",
          desc: "Xe trượt quanh núi dài nhất Đông Nam Á.",
        },
        {
          id: 14,
          title: "Giải mã mê cung",
          image: "game-image/Giải mã mê cung.jpg",
          queue: 30,
          wait: "9:30-18:00",
          desc: "Trò chơi VR, mê cung ảo, quái thú.",
        },
        {
          id: 15,
          title: "Đường đua nghẹt thở",
          image: "game-image/Đường đua nghẹt thở.jpg",
          queue: 0,
          wait: "10:00-18:00",
          desc: "Đang bảo trì, trải nghiệm tay đua.",
          isMaintainance: true,
        },
        {
          id: 16,
          title: "Tata Show",
          image: "game-image/Tata show.jpg",
          queue: 60,
          wait: "19:00-20:00",
          desc: "Show diễn 3D mapping, ánh sáng, diễn viên.",
        },
        {
          id: 17,
          title: "Rạp phim bay",
          image: "game-image/Rạp phim Bay.jpg",
          queue: 45,
          wait: "10:00-18:00",
          desc: "Rạp phim bay, hiệu ứng đặc biệt.",
        },
        {
          id: 18,
          title: "Bật nhảy bungee",
          image: "game-image/Bật nhảy bungee.jpg",
          queue: 17,
          wait: "9:00-18:00",
          desc: "Nhảy bungee, cảm giác mạnh.",
        },
        {
          id: 19,
          title: "Tháp rơi tự do",
          image: "game-image/Tháp rơi tự do.jpg",
          queue: 15,
          wait: "9:00-18:00",
          desc: "Tháp rơi tự do, lực G mạnh.",
        },
        {
          id: 20,
          title: "Đua xe trên không",
          image: "game-image/Đưa xe trên không.jpg",
          queue: 27,
          wait: "9:00-18:00",
          desc: "Lái xe trên không, khúc cua ngoạn mục.",
        },
        {
          id: 21,
          title: "Đu quay dây văng",
          image: "game-image/Đu quay dây văng.jpg",
          queue: 10,
          wait: "9:00-18:00",
          desc: "Đu quay dây văng, cảm giác bay lượn.",
        },
        {
          id: 22,
          title: "Cuộc phiêu lưu hầm mỏ",
          image: "game-image/Cuộc phiêu lưu hầm mỏ.webp",
          queue: 13,
          wait: "9:00-18:00",
          desc: "Đường ray xuyên núi, hầm mỏ bí ẩn.",
        },
        {
          id: 23,
          title: "Zipline",
          image: "game-image/Ziplinepng.png",
          queue: 28,
          wait: "9:00-18:00",
          desc: "Zipline dài nhất, dốc nhất Việt Nam.",
        },
        {
          id: 24,
          title: "Bánh xe bầu trời",
          image: "game-image/Bánh xe bầu trời.webp",
          queue: 12,
          wait: "9:00-18:00",
          desc: "Vòng xoay lớn nhất Việt Nam.",
        },
        {
          id: 25,
          title: "Sky Garden",
          image: "game-image/Sky Garden.jpg",
          queue: 15,
          wait: "9:00-18:00",
          desc: "Vườn cây kỳ hoa dị thảo, check-in đẹp.",
        },
        {
          id: 26,
          title: "Sắc màu Bromelias",
          image: "game-image/Sắc màu Bromeliads.png",
          queue: 8,
          wait: "9:00-18:00",
          desc: "Nhà kính hoa bromeliads, không gian cổ tích.",
        },
        {
          id: 27,
          title: "Lầu vọng cảnh",
          image: "game-image/Lầu vọng cảnh.jpg",
          queue: 8,
          wait: "9:00-18:00",
          desc: "Ngắm toàn cảnh đảo Hòn Tre.",
        },
        {
          id: 28,
          title: "Vườn bướm",
          image: "game-image/Vườn Bướm.jpg",
          queue: 10,
          wait: "9:00-18:00",
          desc: "Vườn bướm, sắc hoa rực rỡ.",
        },
        {
          id: 29,
          title: "Vườn Nhật",
          image: "game-image/Vườn Nhật.jpg",
          queue: 16,
          wait: "9:00-18:00",
          desc: "Không gian Nhật Bản, hồ cá Koi, cầu đỏ.",
        },
        {
          id: 30,
          title: "Hoang mạc châu Phi",
          image: "game-image/Hoang mạc châu Phi.jpg",
          queue: 9,
          wait: "9:00-18:00",
          desc: "Khám phá xương rồng, không gian hoang mạc.",
        },
        {
          id: 31,
          title: "Sắc màu mùa đông",
          image: "game-image/Sắc màu mùa đông.png",
          queue: 7,
          wait: "9:00-18:00",
          desc: "Suối hoa, check-in sống ảo.",
        },
      ];

      // Helper functions
      function showToast(message) {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");
        toastMessage.textContent = message;
        toast.classList.add("show");
        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      function checkCartLimits(gameName) {
        const cart = JSON.parse(localStorage.getItem("gameCart")) || [];

        // Check if cart is full
        if (cart.length >= MAX_CART_ITEMS) {
          showToast(`Giỏ hàng chỉ chứa tối đa ${MAX_CART_ITEMS} trò chơi!`);
          return false;
        }

        // Check if game already exists in cart
        const gameExists = cart.some((item) => item.name === gameName);
        if (gameExists) {
          showToast("Trò chơi này đã có trong giỏ hàng!");
          return false;
        }

        return true;
      }

      function getQueueStatus(queue, isMaintainance = false) {
        if (isMaintainance) {
          return {
            class: "maintain",
            text: "Bảo trì",
            badge: "status-maintain",
            color: "#999",
          };
        }
        if (queue === 0 || queue < 10)
          return { class: "free", text: "Trống", badge: "status-free" };
        if (queue < 20)
          return {
            class: "normal",
            text: "Bình thường (10-20 phút)",
            badge: "status-normal",
          };
        if (queue < 40)
          return {
            class: "busy",
            text: "Đông (20-40 phút)",
            badge: "status-busy",
          };
        return {
          class: "very-busy",
          text: "Rất đông (>40 phút)",
          badge: "status-very-busy",
        };
      }

      function canBookPriority(queue) {
        return queue >= 20; // Enable priority for busy and very busy
      }

      // Render games
      const gameList = document.getElementById("gameList");
      games.forEach((game) => {
        const status = getQueueStatus(game.queue, game.isMaintainance);
        const priorityDisabled = !canBookPriority(game.queue);

        const virtualDisabled = !!game.isMaintainance;

        const card = document.createElement("div");
        card.className = "game-card";

        card.innerHTML = `
          <span class="status-badge ${status.badge}">${status.text.split(" ")[0]}</span>
          <img src="${game.image}" alt="${game.title}">
          <div class="game-content">
            <h3>${game.title}</h3>
            
            <div class="queue-info ${status.class}">
              <i class="fa-solid fa-users"></i>
              <div>
                <div class="queue-number">${game.queue}</div>
                <div class="queue-text">${status.text}</div>
              </div>
            </div>

            
            <div class="time-info">
              <i class="fa-regular fa-clock"></i>
              <span>${game.wait}</span>
            </div>

            <div class="button-group">
              <button class="btn btn-priority" data-id="${game.id}" data-type="priority" ${priorityDisabled ? "disabled" : ""}>
                <i class="fa-solid fa-star"></i>
                Vé ưu tiên
              </button>
              <button class="btn btn-virtual" data-id="${game.id}" data-type="virtual" ${virtualDisabled ? "disabled" : ""}>
                <i class="fa-solid fa-clock"></i>
                Hàng ảo
              </button>
            </div>
          </div>
        `;
        gameList.appendChild(card);
      });

      // Modal elements
      const priorityModal = document.getElementById("priorityModal");
      const virtualModal = document.getElementById("virtualModal");
      const billModal = document.getElementById("billModal");

      let currentGame = null;
      let bookingType = null;

      // Priority booking logic
      let priorityCount = 1;
      let priorityTime = "9:30";

      document.getElementById("priorityPlus").addEventListener("click", () => {
        priorityCount++;
        document.getElementById("priorityCount").textContent = priorityCount;
        updatePriorityTotal();
      });

      document.getElementById("priorityMinus").addEventListener("click", () => {
        if (priorityCount > 1) {
          priorityCount--;
          document.getElementById("priorityCount").textContent = priorityCount;
          updatePriorityTotal();
        }
      });

      function updatePriorityTotal() {
        const total = PRICE_PER_PLAYER * priorityCount;
        document.getElementById("priorityTotal").textContent =
          total.toLocaleString("vi-VN") + " đ";
      }

      // Virtual queue logic
      let virtualCount = 1;
      let virtualTime = "9:30";

      document.getElementById("virtualPlus").addEventListener("click", () => {
        if (virtualCount < MAX_VIRTUAL_PLAYERS) {
          virtualCount++;
          document.getElementById("virtualCount").textContent = virtualCount;
          renderPlayerInputs();
        }
      });

      document.getElementById("virtualMinus").addEventListener("click", () => {
        if (virtualCount > 1) {
          virtualCount--;
          document.getElementById("virtualCount").textContent = virtualCount;
          renderPlayerInputs();
        }
      });

      function renderPlayerInputs() {
        const container = document.getElementById("playerNames");
        container.innerHTML = "";
        for (let i = 1; i <= virtualCount; i++) {
          container.innerHTML += `
            <div class="player-input">
              <label><i class="fa-solid fa-user"></i> Người chơi ${i}:</label>
              <input type="text" id="playerName${i}" placeholder="Nhập tên người chơi ${i}">
            </div>
          `;
        }
      }

      // Handle time selection
      document.querySelectorAll(".time-options").forEach((container) => {
        container.addEventListener("click", (e) => {
          if (e.target.classList.contains("time-btn")) {
            container
              .querySelectorAll(".time-btn")
              .forEach((btn) => btn.classList.remove("active"));
            e.target.classList.add("active");

            if (container.id === "priorityTimeOptions") {
              priorityTime = e.target.dataset.time;
            } else if (container.id === "virtualTimeOptions") {
              virtualTime = e.target.dataset.time;
            }
          }
        });
      });

      // Handle button clicks
      document.querySelectorAll(".btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const gameId = parseInt(e.currentTarget.dataset.id);
          const type = e.currentTarget.dataset.type;

          currentGame = games.find((g) => g.id === gameId);
          bookingType = type;

          if (type === "priority") {
            openPriorityModal();
          } else {
            openVirtualModal();
          }
        });
      });

      function openPriorityModal() {
        priorityCount = 1;
        priorityTime = "9:30";
        document.getElementById("priorityCount").textContent = priorityCount;
        updatePriorityTotal();

        document.getElementById("priorityGameInfo").innerHTML = `
          <img src="${currentGame.image}" alt="${currentGame.title}">
          <h4>${currentGame.title}</h4>
        `;

        document
          .querySelectorAll("#priorityTimeOptions .time-btn")
          .forEach((btn, i) => {
            btn.classList.toggle("active", i === 0);
          });

        priorityModal.style.display = "flex";
      }

      function openVirtualModal() {
        virtualCount = 1;
        virtualTime = "9:30";
        document.getElementById("virtualCount").textContent = virtualCount;
        renderPlayerInputs();

        document.getElementById("virtualGameInfo").innerHTML = `
          <img src="${currentGame.image}" alt="${currentGame.title}">
          <h4>${currentGame.title}</h4>
        `;

        document
          .querySelectorAll("#virtualTimeOptions .time-btn")
          .forEach((btn, i) => {
            btn.classList.toggle("active", i === 0);
          });

        virtualModal.style.display = "flex";
      }

      // Confirm booking
      document
        .getElementById("confirmPriority")
        .addEventListener("click", () => {
          // Validate cart limits before adding
          if (!checkCartLimits(currentGame.title)) {
            return;
          }

          const orderNo = Math.floor(Math.random() * 90000 + 10000);
          const total = PRICE_PER_PLAYER * priorityCount;
          const queuePosition = Math.floor(Math.random() * 3) + 3;

          const billHTML = `
          <p><strong>Trò chơi:</strong> ${currentGame.title}</p>
          <p><strong>Loại vé:</strong> Vé ưu tiên</p>
          <p><strong>Thứ tự ưu tiên:</strong> <span style="color: #f77119; font-weight: 700;">${queuePosition}</span></p>
          <p><strong>Khung giờ:</strong> ${priorityTime}</p>
          <p><strong>Số lượng:</strong> ${priorityCount} người</p>
          <p><strong>Tổng tiền:</strong> <span style="color: #f77119; font-weight: 700;">${total.toLocaleString("vi-VN")} đ</span></p>
          <div class="qr-section">
            <p><i class="fa-solid fa-qrcode"></i> Quét mã QR để xác nhận vé:</p>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=Priority_${orderNo}" alt="QR">
            <p class="order-number">Mã đặt vé: ${orderNo}</p>
          </div>
          <button class="save-btn" id="billConfirmBtn" style="margin-top: 16px;">Xác nhận</button>
        `;

          document.getElementById("billTitle").textContent =
            "Hóa đơn vé ưu tiên";
          document.getElementById("billContent").innerHTML = billHTML;
          priorityModal.style.display = "none";
          billModal.style.display = "flex";

          // Add handler for Xác nhận
          setTimeout(() => {
            const btn = document.getElementById("billConfirmBtn");
            if (btn) {
              btn.onclick = function () {
                // Add to gameCart in localStorage
                const cart = JSON.parse(localStorage.getItem("gameCart")) || [];
                // Ensure image path is relative for game-cart
                let imagePath = currentGame.image;
                if (!/^\.\./.test(imagePath)) {
                  imagePath = '../' + imagePath;
                }
                cart.push({
                  name: currentGame.title,
                  image: imagePath,
                  ticketType: "veutien",
                  time: priorityTime,
                  count: priorityCount,
                  order: queuePosition,
                  names: [],
                  price: total,
                });
                localStorage.setItem("gameCart", JSON.stringify(cart));
                billModal.style.display = "none";
                window.location.href = "game-cart/game-cart.html";
              };
            }
          }, 100);
        });

      document
        .getElementById("confirmVirtual")
        .addEventListener("click", () => {
          // Validate cart limits before adding
          if (!checkCartLimits(currentGame.title)) {
            return;
          }

          const orderNo = Math.floor(Math.random() * 90000 + 10000);
          const queuePosition = Math.floor(Math.random() * 30) + 40;

          let playersHTML =
            "<p><strong>Danh sách người chơi:</strong></p><ol style='padding-left: 20px; margin: 10px 0;'>";
          let playerNames = [];
          for (let i = 1; i <= virtualCount; i++) {
            const name =
              document.getElementById(`playerName${i}`).value.trim() ||
              `Người chơi ${i}`;
            playersHTML += `<li style='margin: 4px 0;'>${name}</li>`;
            playerNames.push(name);
          }
          playersHTML += "</ol>";

          const billHTML = `
          <p><strong>Trò chơi:</strong> ${currentGame.title}</p>
          <p><strong>Loại:</strong> Hàng ảo</p>
          <p><strong>Thứ tự hiện tại:</strong> <span style="color: #3498db; font-weight: 700;">${queuePosition}</span></p>
          <p><strong>Khung giờ:</strong> ${virtualTime}</p>
          <p><strong>Số lượng:</strong> ${virtualCount} người</p>
          <p><strong>Thời gian chờ dự kiến:</strong> 30 phút</p>
          ${playersHTML}
          <div class="qr-section">
            <p><i class="fa-solid fa-qrcode"></i> Quét mã QR để xác nhận:</p>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=Virtual_${orderNo}" alt="QR">
            <p class="order-number">Mã đặt chỗ: ${orderNo}</p>
          </div>
          <button class="save-btn" id="billConfirmBtn" style="margin-top: 16px;">Xác nhận</button>
        `;

          document.getElementById("billTitle").textContent = "Xác nhận hàng ảo";
          document.getElementById("billContent").innerHTML = billHTML;
          virtualModal.style.display = "none";
          billModal.style.display = "flex";

          // Add handler for Xác nhận
          setTimeout(() => {
            const btn = document.getElementById("billConfirmBtn");
            if (btn) {
              btn.onclick = function () {
                // Add to gameCart in localStorage
                const cart = JSON.parse(localStorage.getItem("gameCart")) || [];
                // Ensure image path is relative for game-cart
                let imagePath = currentGame.image;
                if (!/^\.\./.test(imagePath)) {
                  imagePath = '../' + imagePath;
                }
                cart.push({
                  name: currentGame.title,
                  image: imagePath,
                  ticketType: "hangao",
                  time: virtualTime,
                  count: virtualCount,
                  order: queuePosition,
                  names: playerNames,
                  price: null,
                });
                localStorage.setItem("gameCart", JSON.stringify(cart));
                billModal.style.display = "none";
                window.location.href = "game-cart/game-cart.html";
              };
            }
          }, 100);
        });

      // Close modals
      document.getElementById("closePriority").onclick = () =>
        (priorityModal.style.display = "none");
      document.getElementById("closeVirtual").onclick = () =>
        (virtualModal.style.display = "none");
      document.getElementById("closeBill").onclick = () =>
        (billModal.style.display = "none");

      // Close on outside click
      window.onclick = (e) => {
        if (e.target.classList.contains("modal")) {
          e.target.style.display = "none";
        }
      };
    </script>
  </body>
</html>
